buildscript {

    ext {
        es_version = System.getProperty("es.version", "6.5.4")
    }
    // This isn't applying from repositories.gradle so repeating it here
    repositories {

        //TODO: modify the order of evaluation, once we have artifacts in mavenCentral.
        maven {
           name = "internal-snapshots"
            url = "s3://snapshots.opendistro.amazonaws.com/maven"
            authentication {
               awsIm(AwsImAuthentication) // load from EC2 role or env var
            }
        }
        maven {
           name = "internal-releases"
           url = "s3://artifacts.opendistro.amazonaws.com/maven"
           authentication {
               awsIm(AwsImAuthentication) // load from EC2 role or env var
            }
        }
        mavenCentral()
    } 

    dependencies {
        classpath "com.amazonaws.opendistro.elasticsearch.gradle:build-tools:${es_version}"
    }
}

plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'java-library'
}

subprojects {
    group = "com.amazonaws.opendistro.elasticsearch.plugin"
    version = "${version}"
    boolean snapshot = "true".equals(System.getProperty("build.snapshot", "true"));
    if (snapshot) {
        // we update the version property to reflect if we are building a snapshot or a release build
        // we write this back out below to load it in the Build.java which will be shown in rest main action
        // to indicate this being a snapshot build or a release build.
        version += "-SNAPSHOT"
    }
}

test {
    enabled = false
}

